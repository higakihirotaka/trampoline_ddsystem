<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理者コンソール - Trampoline Scoring System</title>
    <style>
        :root { --primary: #263238; --accent: #1a73e8; --bg: #f0f2f5; --card: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: var(--primary); }
        .card { background: var(--card); padding: 50px; border-radius: 24px; width: 440px; border-top: 8px solid var(--primary); text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        h1 { font-size: 1.6rem; font-weight: 900; letter-spacing: 1px; margin-bottom: 5px; }
        p { color: #78909c; font-size: 0.9rem; margin-bottom: 35px; }
        #welcome-message { font-size: 1rem; font-weight: bold; margin-bottom: 25px; color: var(--primary); }
        .form-group { text-align: left; margin-bottom: 25px; }
        label { display: block; font-size: 0.75rem; font-weight: bold; color: #90a4ae; margin: 0 0 8px 5px; text-transform: uppercase; }
        select { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #e1e7eb; font-size: 1rem; background: #f8fbff; cursor: pointer; outline: none; transition: 0.3s; }
        select:focus { border-color: var(--accent); background: #fff; }
        .btn { display: block; width: 100%; padding: 18px; border-radius: 12px; border: none; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s; margin-bottom: 15px; text-decoration: none; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(38, 50, 56, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); background: #1a252b; }
        .btn-outline { background: transparent; color: #90a4ae; border: 2px solid #cfd8dc; }
        .btn-outline:hover { background: #f1f3f4; }
        .footer-link a { color: var(--accent); text-decoration: none; font-size: 0.85rem; font-weight: bold; }
    </style>
</head>
<body>
<div class="card">
    <h1>ADMIN CONSOLE</h1>
    <p id="welcome-message">ようこそ</p>
    <div class="form-group">
        <label>Select Tournament</label>
        <select id="tour-select"><option value="">Loading events...</option></select>
    </div>
    <button class="btn btn-primary" onclick="goMenu()">管理メニュー（ポータル）を開く</button>
    <button class="btn btn-outline" onclick="goPublic()">選手用パブリック画面を表示</button>
    <div class="footer-link"><a href="index.html">← 一般トップページへ</a></div>
</div>

<script type="module">
    // Firebase logic is now handled in auth.js
    import { ensureAdmin, getTournaments } from './auth.js';

    async function populateTournaments() {
        const tournaments = await getTournaments();
        const select = document.getElementById('tour-select');
        select.innerHTML = tournaments.length === 0 ? '<option value="">登録された大会がありません</option>' : '';
        tournaments.forEach(tour => {
            const opt = document.createElement('option');
            opt.value = tour.id;
            opt.text = `[${tour.startDate || '日付未設定'}] ${tour.name || '名称未設定'}`;
            select.appendChild(opt);
        });
    }

    window.goMenu = () => {
        const id = document.getElementById('tour-select').value;
        if (!id) return alert("大会を選択してください");
        location.href = `admin_menu.html?event=${id}`;
    };

    window.goPublic = () => {
        const id = document.getElementById('tour-select').value;
        location.href = id ? `index.html?event=${id}` : 'index.html';
    };

    // Ensure the user is an admin, then populate the dropdown
    ensureAdmin(user => {
        document.getElementById('welcome-message').textContent = `ようこそ、${user.displayName || user.email}さん`;
        populateTournaments();
    });
</script>
</body>
</html>
