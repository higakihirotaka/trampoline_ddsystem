<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§ä¼šç®¡ç†ãƒãƒ¼ã‚¿ãƒ« - Trampoline System</title>
    <link rel="stylesheet" href="style.css">
    <style>
        :root { --primary: #263238; --accent: #1a73e8; --bg: #f0f2f5; --card: #ffffff; --text-main: #263238; --text-sub: #546e7a; --setup-color: #fff8e1; --judge-color: #e3f2fd; --display-color: #f1f8e9; --admin-color: #f5f5f5; --card-color: #fce4ec; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text-main); }
        .container { max-width: 1200px; margin: 0 auto; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .auth-info { font-size: 0.85em; color: #999; display: none; align-items: center; }
        .auth-info span { font-weight: bold; color: var(--text-main); }
        .logout-btn { background: none; border: 1px solid #ccc; border-radius: 5px; color: var(--accent); cursor: pointer; font-size: 0.9em; margin-left: 12px; padding: 3px 8px; }
        .header { text-align: center; margin-bottom: 30px; }
        .event-badge { display: inline-block; padding: 6px 16px; background: var(--accent); color: white; border-radius: 20px; font-weight: bold; }
        .section-title { font-size: 1.2rem; font-weight: 900; margin: 30px 0 15px 10px; display: flex; align-items: center; gap: 10px; border-left: 5px solid var(--accent); padding-left: 15px; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .menu-card { background: var(--card); border-radius: 16px; padding: 20px; text-decoration: none; color: inherit; display: flex; align-items: center; gap: 15px; transition: 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .menu-card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .icon { font-size: 2rem; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .sec-setup .icon { background: var(--setup-color); color: #e65100; }
        .sec-card .icon { background: var(--card-color); color: #c2185b; }
        .sec-judge .icon { background: var(--judge-color); color: #1565c0; }
        .sec-display .icon { background: var(--display-color); color: #2e7d32; }
        .sec-admin .icon { background: var(--admin-color); color: #424242; }
        .card-body h3 { margin: 0; font-size: 1.1rem; }
        .card-body p { margin: 5px 0 0; font-size: 0.85rem; color: var(--text-sub); }
        .footer { text-align: center; margin-top: 40px; padding: 20px; }
        .btn-back { text-decoration: none; color: var(--text-sub); font-size: 0.9rem; border: 1px solid #ccc; padding: 8px 20px; border-radius: 8px; }
        @media (max-width: 600px) { .menu-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="container">
    <div class="header-bar">
        <a href="admin_index.html" class="btn-back">â† å¤§ä¼šé¸æŠã«æˆ»ã‚‹</a>
        <div id="auth-info" class="auth-info">
            <span id="user-name"></span>ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­
            <button id="logout-btn" class="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </div>
    <div class="header">
        <h1 style="margin:0;">Competition Portal</h1>
        <div id="event-name" class="event-badge">Loading...</div>
    </div>
    
    <!-- Menu sections will be populated by script -->
    <div id="menu-container"></div>
</div>

<script type="module">
    // All Firebase logic is now in auth.js
    import { ensureAdmin, logout, getTournamentDetails } from './auth.js';

    const params = new URLSearchParams(location.search);
    const eventId = params.get('event');

    async function initPage() {
        if (!eventId) { 
            location.href = 'admin_index.html'; 
            return; 
        }

        // Fetch tournament details using the centralized function
        const tour = await getTournamentDetails(eventId);
        const eventNameEl = document.getElementById('event-name');
        if (tour) {
            eventNameEl.innerText = tour.name;
        } else {
            eventNameEl.innerText = "å¤§ä¼šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
            return; // Stop if no tournament
        }

        // Dynamically create menu content
        const menuContainer = document.getElementById('menu-container');
        menuContainer.innerHTML = `
            <div class="section-title">ğŸ“‹ å¤§ä¼šå‰è¨­å®š (Pre-Tournament Setup)</div>
            <div class="menu-grid sec-setup">
                <a href="settings.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ”§</span><div class="card-body"><h3>å¤§ä¼šè¨­å®š</h3><p>å¤§ä¼šåã€æ—¥ç¨‹ã€ä¼šå ´ã€ã‚¯ãƒ©ã‚¹ã‚’è¨­å®š</p></div></a>
                <a href="class_rules.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ“œ</span><div class="card-body"><h3>ã‚¯ãƒ©ã‚¹åˆ¥è¨­å®š</h3><p>ã‚¯ãƒ©ã‚¹ã”ã¨ã®äºˆé¸æœ¬æ•°ãƒ»æ±ºå‹äººæ•°ãªã©ã‚’è¨­å®š</p></div></a>
                <a href="athlete_management.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ‘¥</span><div class="card-body"><h3>é¸æ‰‹ç®¡ç†</h3><p>é¸æ‰‹ã®è¿½åŠ ã€å‰Šé™¤ã€ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘</p></div></a>
            </div>

            <div class="section-title">ğŸ´ ç«¶æŠ€ã‚«ãƒ¼ãƒ‰é–¢é€£ (Card Management)</div>
            <div class="menu-grid sec-card">
                <a href="event.html?event=${eventId}&from=admin" class="menu-card"><span class="icon">ğŸ“‹</span><div class="card-body"><h3>é¸æ‰‹å…¥åŠ›ç”»é¢ã®è¡¨ç¤º</h3><p>é¸æ‰‹ãŒç«¶æŠ€ã‚«ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ä¸€è¦§ãƒšãƒ¼ã‚¸</p></div></a>
                <a href="deadline_settings.html?event=${eventId}" class="menu-card"><span class="icon">â°</span><div class="card-body"><h3>ç· ã‚åˆ‡ã‚Šæ™‚é–“ã®è¨­å®š</h3><p>æå‡ºãƒ»ä¿®æ­£ãƒ»æ±ºå‹ã®ç· ã‚åˆ‡ã‚Šæ™‚é–“ã‚’è¨­å®š</p></div></a>
                <a href="bulk_entry.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ“¤</span><div class="card-body"><h3>ç«¶æŠ€ã‚«ãƒ¼ãƒ‰ä¸€æ‹¬ç™»éŒ²</h3><p>CSVã‹ã‚‰æ¼”æŠ€æ§‹æˆã‚’ä¸€æ‹¬ç™»éŒ²</p></div></a>
                <a href="admin_card_edit.html?event=${eventId}" class="menu-card"><span class="icon">âœï¸</span><div class="card-body"><h3>DDã‚«ãƒ¼ãƒ‰ç›´æ¥ç·¨é›†</h3><p>é¸æ‰‹ã®DDã‚«ãƒ¼ãƒ‰ã‚’ç›´æ¥ç·¨é›†ï¼ˆç·Šæ€¥ç”¨ï¼‰</p></div></a>
            </div>

            <div class="section-title">âš–ï¸ å¯©åˆ¤ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ (Judge Operations)</div>
            <div class="menu-grid sec-judge">
                <a href="admin_card_check.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ”</span><div class="card-body"><h3>ã‚«ãƒ¼ãƒ‰æå‡ºçŠ¶æ³ã®ç¢ºèª</h3><p>å…¨é¸æ‰‹ã®ã‚«ãƒ¼ãƒ‰æå‡ºçŠ¶æ³ã¨å†…å®¹ã‚’ç¢ºèª</p></div></a>
                <a href="judge_role_select.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ‘¨â€âš–ï¸</span><div class="card-body"><h3>å¯©åˆ¤å“¡ç”»é¢ï¼ˆå½¹å‰²é¸æŠï¼‰</h3><p>å¯©åˆ¤å“¡ç”¨ã®å½¹å‰²é¸æŠç”»é¢ã‚’é–‹ã</p></div></a>
            </div>

            <div class="section-title">ğŸ–¥ï¸ ç”»é¢è¡¨ç¤ºç³» (Displays)</div>
            <div class="menu-grid sec-display">
                <a href="venue_display.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ“º</span><div class="card-body"><h3>ä¼šå ´ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤</h3><p>é¸æ‰‹ã‚„ç¨®ç›®ã€å¾—ç‚¹ã‚’ä¼šå ´ã«è¡¨ç¤º</p></div></a>
            </div>

            <div class="section-title">âš™ï¸ ç®¡ç†è€…ç³» (Administration)</div>
            <div class="menu-grid sec-admin">
                <a href="admin_url_gen.html?event=${eventId}" class="menu-card"><span class="icon">ğŸ”—</span><div class="card-body"><h3>URLç”Ÿæˆ</h3><p>é¸æ‰‹ã¸ã®é…å¸ƒç”¨URLã‚’ç”Ÿæˆ</p></div></a>
            </div>
        `;
    }

    // Main entry point for the page
    ensureAdmin(user => {
        // User is confirmed to be an admin.
        const authInfo = document.getElementById('auth-info');
        const userName = document.getElementById('user-name');
        userName.textContent = user.displayName || user.email;
        authInfo.style.display = 'flex';
        document.getElementById('logout-btn').onclick = logout;
        
        // Proceed with page initialization
        initPage();
    });
</script>
</body>
</html>
